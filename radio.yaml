homeassistant:

script:

  radio_comercial_sala:
    alias: Radio Comercial sala
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.sala
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.sala
          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
          media_content_type: 'audio/mp4'

  radio_comercial_cozinha:
    alias: Radio Comercial cozinha
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.cozinha
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.cozinha
          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
          media_content_type: 'audio/mp4'

  radio_comercial_escritorio:
    alias: Radio Comercial escritorio
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.escritorio
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.escritorio
          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
          media_content_type: 'audio/mp4'

  radio_comercial_ambiente:
    alias: Radio Comercial ambiente
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.som_ambiente
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.som_ambiente
          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
          media_content_type: 'audio/mp4'

#rfm

  rfm_sala:
    alias: RFM sala
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.sala
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.sala
          media_content_id: https://20863.live.streamtheworld.com/RFM_SC
          media_content_type: 'audio/mp4'

  rfm_cozinha:
    alias: RFM cozinha
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.cozinha
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.cozinha
          media_content_id: https://20863.live.streamtheworld.com/RFM_SC
          media_content_type: 'audio/mp4'

  rfm_escritorio:
    alias: RFM escritorio
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.escritorio
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.escritorio
          media_content_id: https://20863.live.streamtheworld.com/RFM_SC
          media_content_type: 'audio/mp4'

  rfm_ambiente:
    alias: RFM ambiente
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.som_ambiente
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.som_ambiente
          media_content_id: https://20863.live.streamtheworld.com/RFM_SC
          media_content_type: 'audio/mp4'

#m80

  m80_sala:
    alias: M80 sala
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.sala
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.sala
          media_content_id: http://mcrscast.mcr.iol.pt/m80
          media_content_type: 'audio/mp4'

  m80_cozinha:
    alias: M80 cozinha
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.cozinha
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.cozinha
          media_content_id: http://mcrscast.mcr.iol.pt/m80
          media_content_type: 'audio/mp4'

  m80_escritorio:
    alias: M80 escritorio
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.escritorio
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.escritorio
          media_content_id: http://mcrscast.mcr.iol.pt/m80
          media_content_type: 'audio/mp4'

  m80_ambiente:
    alias: M80 ambiente
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.som_ambiente
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.som_ambiente
          media_content_id: http://mcrscast.mcr.iol.pt/m80
          media_content_type: 'audio/mp4'

#vodafone

  vodafone_sala:
    alias: Vodafone sala
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.sala
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.sala
          media_content_id: http://195.23.102.207/vodafone
          media_content_type: 'audio/mp4'

  vodafone_cozinha:
    alias: Vodafone cozinha
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.cozinha
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.cozinha
          media_content_id: http://195.23.102.207/vodafone
          media_content_type: 'audio/mp4'

  vodafone_escritorio:
    alias: Vodafone escritorio
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.escritorio
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.escritorio
          media_content_id: http://195.23.102.207/vodafone
          media_content_type: 'audio/mp4'

  vodafone_ambiente:
    alias: Vodafone ambiente
    sequence:
      - service: media_player.volume_set
        data:
          entity_id: media_player.som_ambiente
          volume_level: '0.20'
      - service: media_player.play_media
        data_template:
          entity_id: media_player.som_ambiente
          media_content_id: http://195.23.102.207/vodafone
          media_content_type: 'audio/mp4'

  radio_stop_sala:
    alias: Parar rádio sala
    sequence:
      - service: media_player.media_stop
        data:
          entity_id: media_player.sala

  radio_stop_cozinha:
    alias: Parar rádio cozinha
    sequence:
      - service: media_player.media_stop
        data:
          entity_id: media_player.cozinha

  radio_stop_escritorio:
    alias: Parar rádio escritorio
    sequence:
      - service: media_player.media_stop
        data:
          entity_id: media_player.escritorio

  radio_stop_som_ambiente:
    alias: Parar rádio ambiente
    sequence:
      - service: media_player.media_stop
        data:
          entity_id: media_player.som_ambiente

###############################################################################
#                                                                             #
#                       I N P U T _ B O O L E A N                             #
#                                                                             #
############################################################################### 
input_boolean:
  ligar_radio:
    name: Rádio Status

  som_ambiente:
    name: Som Ambiente

  ouvir_radio_sala:
    name: Ouvir rádio na sala
###############################################################################
#                                                                             #
#                     I N P U T _ D A T E T I M E                             #
#                                                                             #
###############################################################################
input_datetime:
  radio_on:
    name: "Ligar rádio às"
    has_date: false
    has_time: true

###############################################################################
#                                                                             #
#                     I N P U T _ N U M B E R                                 #
#                                                                             #
###############################################################################
input_number:
  sala_volume:
    icon: mdi:volume-medium
    name: Volume
    min: 1
    max: 100
    step: 1

  cozinha_volume:
    icon: mdi:volume-medium
    name: Volume
    min: 1
    max: 100
    step: 1

  ambiente_volume:
    icon: mdi:volume-medium
    name: Volume
    min: 1
    max: 100
    step: 1
###############################################################################
#                                                                             #
#                               S E N S O R                                   #
#                                                                             #
###############################################################################
sensor:

  - platform: template
    sensors:
      estacoes_radio_sala:
        friendly_name: 'Estações radio sala'
        value_template: >
          {%- if states.media_player.sala.attributes.media_content_id == "http://mcrscast1.mcr.iol.pt/comercial.mp3" %}
            Comercial Sala
          {% elif states.media_player.sala.attributes.media_content_id == "http://195.23.102.207/vodafone" %}
            Vodafone Sala
          {% elif states.media_player.sala.attributes.media_content_id == "http://mcrscast.mcr.iol.pt/m80" %}
            M80 Sala
          {% elif states.media_player.sala.attributes.media_content_id == "https://20863.live.streamtheworld.com/RFM_SC" %}
            RFM Sala
          {% else %}
            Desligado
          {%- endif %}

  - platform: template
    sensors:
      estacoes_radio_cozinha:
        friendly_name: 'Estações radio cozinha'
        value_template: >
          {%- if states.media_player.cozinha.attributes.media_content_id == "http://mcrscast1.mcr.iol.pt/comercial.mp3" %}
            Comercial Cozinha
          {% elif states.media_player.cozinha.attributes.media_content_id == "http://195.23.102.207/vodafone" %}
            Vodafone Cozinha
          {% elif states.media_player.cozinha.attributes.media_content_id == "http://mcrscast.mcr.iol.pt/m80" %}
            M80 Cozinha
          {% elif states.media_player.cozinha.attributes.media_content_id == "https://20863.live.streamtheworld.com/RFM_SC" %}
            RFM Cozinha
          {% else %}
            Desligado
          {%- endif %}

  - platform: template
    sensors:
      estacoes_radio_escritorio:
        friendly_name: 'Estações radio escritório'
        value_template: >
          {%- if states.media_player.escritorio.attributes.media_content_id == "http://mcrscast1.mcr.iol.pt/comercial.mp3" %}
            Comercial Escritório
          {% elif states.media_player.escritorio.attributes.media_content_id == "http://195.23.102.207/vodafone" %}
            Vodafone Escritório
          {% elif states.media_player.escritorio.attributes.media_content_id == "http://mcrscast.mcr.iol.pt/m80" %}
            M80 Escritório
          {% elif states.media_player.escritorio.attributes.media_content_id == "https://20863.live.streamtheworld.com/RFM_SC" %}
            RFM Escritório
          {% else %}
            Desligado
          {%- endif %}

  - platform: template
    sensors:
      estacoes_radio_ambiente:
        friendly_name: 'Estações radio ambiente'
        value_template: >
          {%- if states.media_player.som_ambiente.attributes.media_content_id == "http://mcrscast1.mcr.iol.pt/comercial.mp3" %}
            Comercial Ambiente
          {% elif states.media_player.som_ambiente.attributes.media_content_id == "http://195.23.102.207/vodafone" %}
            Vodafone Ambiente
          {% elif states.media_player.som_ambiente.attributes.media_content_id == "http://mcrscast.mcr.iol.pt/m80" %}
            M80 Ambiente
          {% elif states.media_player.som_ambiente.attributes.media_content_id == "https://20863.live.streamtheworld.com/RFM_SC" %}
            RFM Ambiente
          {% else %}
            Desligado
          {%- endif %}


  - platform: template
    sensors:
      sala_volume:
        value_template: >
          {% if is_state('media_player.sala', 'on')  %}
            {{ (state_attr('media_player.sala', 'volume_level') * 100) | int }}
          {% endif %}
        friendly_name: Receiver Volume Level
        icon_template: mdi:volume-medium

  - platform: template
    sensors:
      cozinha_volume:
        value_template: >
          {% if is_state('media_player.cozinha', 'on')  %}
            {{ (state_attr('media_player.cozinha', 'volume_level') * 100) | int }}
          {% endif %}
        friendly_name: Receiver Volume Level
        icon_template: mdi:volume-medium

  - platform: template
    sensors:
      escritorio_volume:
        value_template: >
          {% if is_state('media_player.escritorio', 'on')  %}
            {{ (state_attr('media_player.escritorio', 'volume_level') * 100) | int }}
          {% endif %}
        friendly_name: Receiver Volume Level
        icon_template: mdi:volume-medium

  - platform: template
    sensors:
      ambiente_volume:
        value_template: >
          {% if is_state('media_player.som_ambiente', 'on')  %}
            {{ (state_attr('media_player.som_ambiente', 'volume_level') * 100) | int }}
          {% endif %}
        friendly_name: Receiver Volume Level
        icon_template: mdi:volume-medium



#Comercial

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Artista
    select: "DB_LEAD_ARTIST_NAME"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Música
    select: "DB_SONG_NAME"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Album
    select: "DB_ALBUM_NAME"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Imagem do album
    select: "DB_ALBUM_IMAGE"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Informação
    select: "DB_ALT_COVER_IMAGE"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Titulos
    select: "DB_DALET_TITLE_NAME"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Locutor comercial
    select: "NAME"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: Imagem Lucotor comercial
    select: "IMAGE"

  - platform: scrape
    resource: https://radiocomercial.iol.pt/nowplaying.xml
    name: show name comercial
    select: "SHOW_NAME"

#m80

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Música m80
    select: "DB_SONG_NAME"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Album m80
    select: "DB_ALBUM_NAME"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Artista m80
    select: "DB_LEAD_ARTIST_NAME"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Imagem do album m80
    select: "DB_ALBUM_IMAGE"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Informação m80
    select: "DB_ALT_COVER_IMAGE"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Titulos m80
    select: "DB_DALET_TITLE_NAME"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: Informação M80
    select: "IMAGE_FILENAME"

  - platform: scrape
    resource: https://m80.iol.pt/nowplaying.xml
    name: M80
    select: "NAME"

#vodafone

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Música vodafone
    select: "DB_SONG_NAME"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Album vodafone
    select: "DB_ALBUM_NAME"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Artista vodafone
    select: "DB_LEAD_ARTIST_NAME"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Imagem do album vodafone
    select: "DB_ALBUM_IMAGE"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Informação vodafone
    select: "DB_ALT_COVER_IMAGE"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Titulos vodafone
    select: "DB_DALET_TITLE_NAME"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Informação vodafone
    select: "IMAGE_FILENAME"

  - platform: scrape
    resource: https://vodafone.fm/nowplaying.xml
    name: Vodafone
    select: "NAME"

#RFM

  - platform: command_line
    name: RFM Album
    command: "python3 /config/python_scripts/radio_details.py name"

  - platform: command_line
    name: Artista rfm
    command: "python3 /config/python_scripts/radio_details.py artist"

  - platform: command_line
    name: Informação RFM
    command: "python3 /config/python_scripts/radio_details.py capa"

###############################################################################
#                                                                             #
#                      C A M E R A S  C O M E R C I A L                       #
#                                                                             #
###############################################################################
camera:

#comercial

  - platform: generic
    name: Comercial Camera
    still_image_url: '{% if states.sensor.imagem_do_album.state != "" %}https://radiocomercial.iol.pt/upload/album/{{ states.sensor.imagem_do_album.state }}{% else %}{% if states.sensor.informacao.state != "" %}https://radiocomercial.iol.pt/{{ states.sensor.informacao.state }}{% else %}https://radiocomercial.iol.pt/upload/c/comercial.jpg{% endif %}{% endif %}'

#M80

  - platform: generic
    name: M80 Camera
    still_image_url: '{% if states.sensor.imagem_do_album_m80.state != "" %}https://m80.iol.pt/upload/album/{{ states.sensor.imagem_do_album_m80.state }}{% else %}{% if states.sensor.informacao_m80.state != "" %}https://m80.iol.pt/{{ states.sensor.informacao_m80.state }}{% else %}https://m80.iol.pt/upload/m/m80.png{% endif %}{% endif %}'

#vodafone

  - platform: generic
    name: Vodafone Camera
    still_image_url: '{% if states.sensor.imagem_do_album_vodafone.state != "" %}https://vodafone.fm/upload/album/{{ states.sensor.imagem_do_album_vodafone.state }}{% else %}{% if states.sensor.informacao_vodafone.state != "" %}https://vodafone.fm/{{ states.sensor.informacao_vodafone.state }}{% else %}https://vodafone.fm/images/nocover.png{% endif %}{% endif %}'

#RFM

  - platform: generic
    name: RFM Camera
    still_image_url: '{% if states.sensor.informacao_rfm.state != "" %}https://cdnimages01.azureedge.net/rfm/{{ states.sensor.informacao_rfm.state }}{% else %}https://cdnimages01.azureedge.net/rfm/default300x3002255339a_117162246.jpg{% endif %}'
###############################################################################
#                                                                             #
#                           A U T O M A Ç Õ E S                               #
#                                                                             #
###############################################################################   
automation:






#  - alias: Ligar rádio
#    initial_state: false
#    trigger:
#      - platform: template
#        value_template: "{{ states('sensor.time') == (states.input_datetime.radio_on.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
#    condition:
#      condition: and
#      conditions:
#      - condition: state
#        entity_id: input_boolean.ligar_radio
#        state: 'on'
#      - condition: state
#        entity_id: person.bruno
#        state: home
#      - condition: state
#        entity_id: person.armanda
#        state: not_home
#      - condition: state
#        entity_id: 'binary_sensor.workday_sensor'
#        state: 'on'
#    action:
#      - service: media_player.volume_set
#        data:
#          entity_id: media_player.som_ambiente
#          volume_level: '0.15'
#      -  service: media_player.play_media
#         data_template:
#          entity_id: media_player.som_ambiente
#          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
#          media_content_type: 'audio/mp4'


#  - alias: Desligar rádio na ausencia
#    initial_state: false
#    trigger:
#      - platform: state
#        entity_id: device_tracker.bruno_melo
#        from: home
#        to: not_home
#    action:
#      - service: script.turn_on
#        entity_id: 
#          - script.radio_stop_sala
#          - script.radio_stop_cozinha

#zigbee botao ikea controlo volume

#  - alias: Diminuir som sala
#    initial_state: true
#    trigger: 
#      platform: state
#      entity_id: sensor.0x000d6ffffebcd992_click
#      to: 'off'
#    action:
#      - service: media_player.volume_set
#        entity_id: media_player.sala
#        data_template:
#          volume_level: '{{ states.media_player.sala.attributes.volume_level - 0.06 }}'

#  - alias: Aumentar som sala
#    initial_state: true
#    trigger: 
#      platform: state
#      entity_id: sensor.0x000d6ffffebcd992_click
#      to: 'on'
#    action:
#      - service: media_player.volume_set
#        entity_id: media_player.sala
#        data_template:
#          volume_level: '{{ states.media_player.sala.attributes.volume_level + 0.06 }}'


#  - alias: Diminuir som cozinha
#    initial_state: true
#    trigger: 
#      platform: state
#      entity_id: sensor.0x000d6ffffebcd992_click
#      to: 'off'
#    action:
#      - service: media_player.volume_set
#        entity_id: media_player.cozinha
#        data_template:
#          volume_level: '{{ states.media_player.cozinha.attributes.volume_level - 0.06 }}'

#  - alias: Aumentar som cozinha
#    initial_state: true
#    trigger: 
#      platform: state
#      entity_id: sensor.0x000d6ffffebcd992_click
#      to: 'on'
#    action:
#      - service: media_player.volume_set
#        entity_id: media_player.cozinha
#        data_template:
#          volume_level: '{{ states.media_player.cozinha.attributes.volume_level + 0.06 }}'

#  - alias: Ligar radio de manha
#    initial_state: true
#    trigger:
#      - platform: time
#        at: "07:15:00"
#    condition:
#      - condition: state
#        entity_id: 'binary_sensor.workday_sensor'
#        state: 'on'
#    action:
#      - service: media_player.volume_set
#        data:
#          entity_id: media_player.sala
#          volume_level: '0.30'
#      -  service: media_player.play_media
#         data_template:
#          entity_id: media_player.sala
#          media_content_id: http://mcrscast1.mcr.iol.pt/comercial.mp3
#          media_content_type: 'audio/mp4'

  - alias: "Sala set Volume"
    initial_state: 'on'
    trigger:
      platform: state
      entity_id: input_number.sala_volume
    action:
      - service: media_player.volume_set
        data_template:
          entity_id: media_player.sala
          volume_level: >
            {{states('input_number.sala_volume') | int / 100}}

  - alias: "Sala Update Volume Slider"
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.sala_volume
      - platform: homeassistant
        event: start
    condition:
      condition: state
      entity_id: media_player.sala # receiver must be on to set the volume, without this would throw error on startup
      state: 'on'
    action:
      - delay:
          seconds: 3
      - service: input_number.set_value
        data_template:
          entity_id: input_number.sala_volume
          value: '{{ trigger.to_state.state }}'


  - alias: "Cozinha set Volume"
    initial_state: 'on'
    trigger:
      platform: state
      entity_id: input_number.cozinha_volume
    action:
      - service: media_player.volume_set
        data_template:
          entity_id: media_player.cozinha
          volume_level: >
            {{states('input_number.cozinha_volume') | int / 100}}

  - alias: "cozinha Update Volume Slider"
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.cozinha_volume
      - platform: homeassistant
        event: start
    condition:
      condition: state
      entity_id: media_player.cozinha # receiver must be on to set the volume, without this would throw error on startup
      state: 'on'
    action:
      - delay:
          seconds: 3
      - service: input_number.set_value
        data_template:
          entity_id: input_number.cozinha_volume
          value: '{{ trigger.to_state.state }}'

  - alias: "Ambiente set Volume"
    initial_state: 'on'
    trigger:
      platform: state
      entity_id: input_number.ambiente_volume
    action:
      - service: media_player.volume_set
        data_template:
          entity_id: media_player.som_ambiente
          volume_level: >
            {{states('input_number.ambiente_volume') | int / 100}}

  - alias: "ambiente Update Volume Slider"
    initial_state: 'on'
    trigger:
      - platform: state
        entity_id: sensor.ambiente_volume
      - platform: homeassistant
        event: start
    condition:
      condition: state
      entity_id: media_player.som_ambiente # receiver must be on to set the volume, without this would throw error on startup
      state: 'on'
    action:
      - delay:
          seconds: 3
      - service: input_number.set_value
        data_template:
          entity_id: input_number.ambiente_volume
          value: '{{ trigger.to_state.state }}'

###############################################################################
#                                                                             #
#                         G R O U P S                                         #
#                                                                             #
###############################################################################      
#group:

#  som_ambiente:
#    name: som Ambiente
#    entities:
#      - media_player.cozinha
#      - media_player.sala


#  comercial_testes:
#    name: Cameras imagens comercial
#    entities:
#      - camera.album_comercial
#      - camera.comercial_informacao
#      - camera.informacao_comercial



